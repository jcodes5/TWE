generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id               String         @id @default(cuid())
  email            String         @unique
  firstName        String
  lastName         String
  phone            String?
  password         String
  role             UserRole       @default(VOLUNTEER)
  verified         Boolean        @default(false)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  auditLogs        AuditLog[]
  blogPosts        BlogPost[]
  campaigns        Campaign[]
  comments         Comment[]
  assignedContacts Contact[]
  donations        Donation[]
  createdImages    GalleryImage[]
  refreshTokens    RefreshToken[]

  @@map("users")
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique @db.VarChar(500)
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "refresh_tokens_userId_fkey")
  @@map("refresh_tokens")
}

model Campaign {
  id          String         @id @default(cuid())
  title       String
  description String
  content     String
  image       String?
  goal        Float
  raised      Float          @default(0)
  category    String
  location    String
  status      CampaignStatus @default(DRAFT)
  createdById String
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  endDate     DateTime?
  impactLevel ImpactLevel    @default(REGIONAL)
  startDate   DateTime?
  urgency     UrgencyLevel   @default(MEDIUM)
  latitude    Float?
  longitude   Float?
  createdBy   User           @relation(fields: [createdById], references: [id])
  donations   Donation[]

  @@index([createdById], map: "campaigns_createdById_fkey")
  @@map("campaigns")
}

model Donation {
  id         String   @id @default(cuid())
  amount     Float
  campaignId String
  userId     String
  createdAt  DateTime @default(now())
  campaign   Campaign @relation(fields: [campaignId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@index([campaignId], map: "donations_campaignId_fkey")
  @@index([userId], map: "donations_userId_fkey")
  @@map("donations")
}

model BlogPost {
  id        String     @id @default(cuid())
  title     String
  content   String     @db.Text
  excerpt   String?
  image     String?
  category  String
  status    PostStatus @default(DRAFT)
  authorId  String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  author    User       @relation(fields: [authorId], references: [id])
  comments  Comment[]

  @@index([authorId], map: "blog_posts_authorId_fkey")
  @@map("blog_posts")
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  postId    String
  userId    String
  createdAt DateTime @default(now())
  post      BlogPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id])

  @@index([postId], map: "comments_postId_fkey")
  @@index([userId], map: "comments_userId_fkey")
  @@map("comments")
}

model Contact {
  id           String        @id @default(cuid())
  name         String
  email        String
  phone        String?
  organization String?
  subject      String
  message      String
  inquiryType  String
  status       ContactStatus @default(NEW)
  createdAt    DateTime      @default(now())
  assignedToId String?
  assignedTo   User?         @relation(fields: [assignedToId], references: [id])

  @@index([assignedToId], map: "contacts_assignedToId_fkey")
  @@map("contacts")
}

model GalleryImage {
  id           String      @id @default(cuid())
  title        String
  url          String
  publicId     String
  category     String?
  description  String?
  takenAt      DateTime?
  location     String?
  createdById  String
  createdAt    DateTime    @default(now())
  altText      String?
  fileSize     Int?
  format       String?
  height       Int?
  sortOrder    Int         @default(0)
  status       ImageStatus @default(ACTIVE)
  tags         Json?
  thumbnailUrl String?
  updatedAt    DateTime    @updatedAt
  width        Int?
  createdBy    User        @relation(fields: [createdById], references: [id])

  @@index([category])
  @@index([status])
  @@index([sortOrder])
  @@index([createdById], map: "gallery_images_createdById_fkey")
  @@map("gallery_images")
}

model AuditLog {
  id            String      @id @default(cuid())
  entityType    EntityType
  entityId      String
  action        AuditAction
  changedData   Json?
  performedById String
  createdAt     DateTime    @default(now())
  performedBy   User        @relation(fields: [performedById], references: [id])

  @@index([entityType, entityId])
  @@index([performedById], map: "audit_logs_performedById_fkey")
  @@map("audit_logs")
}

enum UserRole {
  ADMIN
  VOLUNTEER
  SPONSOR
}

enum CampaignStatus {
  DRAFT
  ACTIVE
  COMPLETED
  CANCELLED
}

enum PostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum ContactStatus {
  NEW
  IN_PROGRESS
  RESOLVED
  ARCHIVED
}

enum UrgencyLevel {
  HIGH
  MEDIUM
  LOW
}

enum ImpactLevel {
  INTERNATIONAL
  NATIONAL
  REGIONAL
  LOCAL
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
}


enum ImageStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
  PENDING_REVIEW
}

model Notification {
  id          String            @id @default(cuid())
  title       String
  description String
  type        NotificationType  @default(INFO)
  read        Boolean           @default(false)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@map("notifications")
}

enum NotificationType {
  INFO
  WARNING
  SUCCESS
}

model Setting {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String   @db.Text
  description String?
  category    String   @default("general")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("settings")
}

enum EntityType {
  USER
  CAMPAIGN
  BLOG_POST
  GALLERY_IMAGE
  CONTACT
  SETTING
}
